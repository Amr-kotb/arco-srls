<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ARCO SRLS - Attrezzi Cantiere cortina</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#0b1e3f;color:white;padding:20px;}
h1{text-align:center;margin-bottom:30px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;}
.card{background:#082b5c;border-radius:12px;display:flex;flex-direction:column;align-items:center;padding:15px;text-align:center;min-height:260px;}
.card img{width:190px;height:140px;object-fit:contain;margin-bottom:10px;border-radius:8px;}
.quantity-container{display:flex;justify-content:center;align-items:center;gap:8px;margin-top:auto;}
.quantity-container button{background:#00ffaa;color:#003366;border:none;padding:6px 12px;font-size:16px;cursor:pointer;border-radius:6px;transition:0.3s;}
.quantity-container button:hover{background:#00cc88;}
.quantity-container input{width:45px;text-align:center;font-size:16px;border:2px solid #003366;border-radius:6px;}
.top-buttons { text-align:center; margin-bottom:20px; }
.top-buttons button { margin: 0 5px; padding: 10px 20px; border: none; border-radius: 8px; background: #00ffaa; color: #0b1e3f; font-weight: bold; cursor: pointer; }
.top-buttons button:hover { background: #00cc88; }
.riepilogo { margin-top:40px; background:#082b5c; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.5);}
.riepilogo h2 { color:#00ffaa; text-align:center; margin-bottom:15px;}
.riepilogo ul { list-style:none; padding:0; margin:0; display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:10px 20px;}
.riepilogo li { font-size:16px; padding:6px 10px; background:#0b1e3f; border-radius:8px; text-align:center;}
.save-indicator { position: fixed; bottom: 20px; right: 20px; background: #00cc88; color: #003366; padding: 10px 15px; border-radius: 8px; font-weight: bold; opacity: 0; transition: opacity 0.3s; box-shadow: 0 2px 10px rgba(0,0,0,0.3);}
.save-indicator.visible { opacity: 1;}
</style>
</head>
<body>
<div class="top-buttons">
  <button onclick="window.location.href='index.html'">üè† Home Page</button>
  <button onclick="window.location.href='riepilogo.html'">üìä Riepilogo Tutti Cantieri</button>
</div>
<h1>cortina Attrezzi</h1>
<div class="grid" id="gridAttrezzi"></div>
<div class="save-indicator" id="saveIndicator">Dati salvati ‚úî</div>
<div class="riepilogo"><h2>Riepilogo Quantit√†</h2><ul id="riepilogoList"></ul></div>

<script>
const cantiereID = "cortina"; 
const attrezzi = ["Avvitatore","Trapano","Laser","Batteria","Carica Batteria","Seghetto","Sparachiodi","Smerigliatrice"];
const container = document.getElementById('gridAttrezzi');
const riepilogoList = document.getElementById('riepilogoList');
const saveIndicator = document.getElementById('saveIndicator');
let dataQuantities = {};

async function updateQuantity(att, value){
  dataQuantities[att] = value;
  try {
    await fetch(`/api/data/${cantiereID}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(dataQuantities)
    });
    showSaveIndicator();
  } catch(e) { console.error(e); }
}

function showSaveIndicator() {
  saveIndicator.classList.add('visible');
  setTimeout(() => saveIndicator.classList.remove('visible'), 2000);
}

function aggiornaRiepilogo(){
  riepilogoList.innerHTML = "";
  attrezzi.forEach(att => {
    const li = document.createElement('li');
    li.textContent = `${att}: ${dataQuantities[att] || 0}`;
    riepilogoList.appendChild(li);
  });
}

attrezzi.forEach(att => {
  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <img src="../trecce/${att.toLowerCase()}.png" alt="${att}">
    <h2>${att}</h2>
    <div class="quantity-container">
      <button class="dec">-</button>
      <input type="number" value="0" min="0">
      <button class="inc">+</button>
    </div>`;
  container.appendChild(card);

  const input = card.querySelector('input');
  card.querySelector('.inc').addEventListener('click', () => {
    input.value = (parseInt(input.value)||0)+1;
    updateQuantity(att, parseInt(input.value));
    aggiornaRiepilogo();
  });
  card.querySelector('.dec').addEventListener('click', () => {
    input.value = Math.max(0,(parseInt(input.value)||0)-1);
    updateQuantity(att, parseInt(input.value));
    aggiornaRiepilogo();
  });
  input.addEventListener('change', () => {
    input.value = Math.max(0, parseInt(input.value)||0);
    updateQuantity(att, parseInt(input.value));
    aggiornaRiepilogo();
  });
});

async function fetchData(){
  try {
    const res = await fetch('/api/data');
    const data = await res.json();
    dataQuantities = data.cantieri[cantiereID];
    attrezzi.forEach(att => {
      const card = [...container.children].find(c => c.querySelector('h2').textContent===att);
      if(card) card.querySelector('input').value = dataQuantities[att] || 0;
    });
    aggiornaRiepilogo();
  } catch(e) { console.error(e); }
}

fetchData();
setInterval(fetchData,2000);
</script>
</body>
</html>
